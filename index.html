<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LeCard Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; overflow-x: hidden; }
    body { font-family: 'Inter', -apple-system, sans-serif; background: #111827; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
    ::-webkit-scrollbar-thumb { background: rgba(252,211,77,0.3); border-radius: 3px; }
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
  </style>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;


// ==================== FIREBASE CONFIG ====================
const FIREBASE_DB_URL = 'https://acompanhamento-comercial-a28ab-default-rtdb.firebaseio.com';

async function fbGet(path) {
  const res = await fetch(`${FIREBASE_DB_URL}/${path}.json`);
  return res.json();
}
async function fbSet(path, data) {
  await fetch(`${FIREBASE_DB_URL}/${path}.json`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
}

// ==================== DEFAULT DATA ====================
const defaultState = {
  data: {
    rows: [
      { Nome: 'Fernando', Contratos: 5, Faturamento: 22000, Cartoes: 14, Nivel: 'Bronze', Badges: 0 },
      { Nome: 'Thaislayne', Contratos: 9, Faturamento: 15200, Cartoes: 96, Nivel: 'Bronze', Badges: 0 },
      { Nome: 'Sarah', Contratos: 3, Faturamento: 15000, Cartoes: 17, Nivel: 'Bronze', Badges: 0 },
      { Nome: 'Bruna', Contratos: 7, Faturamento: 8000, Cartoes: 14, Nivel: 'Bronze', Badges: 0 },
      { Nome: 'Alisson', Contratos: 1, Faturamento: 3000, Cartoes: 11, Nivel: 'Bronze', Badges: 0 },
      { Nome: 'Vitor F.', Contratos: 3, Faturamento: 3000, Cartoes: 9, Nivel: 'Bronze', Badges: 0 },
      { Nome: 'Luiza', Contratos: 0, Faturamento: 0, Cartoes: 0, Nivel: 'Bronze', Badges: 0 },
      { Nome: 'Larissa', Contratos: 0, Faturamento: 0, Cartoes: 0, Nivel: 'Bronze', Badges: 0 },
      { Nome: 'Gizely', Contratos: 0, Faturamento: 0, Cartoes: 0, Nivel: 'Bronze', Badges: 0 }
    ]
  },
  goals: {
    meta2026: 600000000, base2025: 226000000, gap: 36338000,
    vendedoresInternos: 7, vendedoresExternos: 50,
    metaMensalInterno: 297000, metaMensalExterno: 45000
  },
  projections: { internosTotal: 162162000, externosTotal: 175500000, projecaoTotal: 563662000 },
  cardValues: { revenue: null, contracts: null, cards: null, ticketMedio: null },
  photos: {},
  monthlyKPIs: { '2026-01': { revenue: 0, contracts: 0, cards: 0, manual: {} }, '2026-02': { revenue: 0, contracts: 0, cards: 0, manual: {} } },
  vendorMonthlyKPIs: {},
  customizations: { texts: {}, colors: {}, logo: '' },
  vendorStatus: {} // { [index]: { lastSaleDate: 'YYYY-MM-DD' } }
};

// ==================== HELPERS ====================
const formatCurrency = (v) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(v || 0);
const formatNumber = (v) => new Intl.NumberFormat('pt-BR').format(Math.round(v || 0));
const formatCompact = (v) => { if (v >= 1e6) return (v / 1e6).toFixed(1) + 'M'; if (v >= 1e3) return (v / 1e3).toFixed(0) + 'K'; return String(v); };

const getLevel = (pct) => { if (pct >= 110) return 'Diamante'; if (pct >= 90) return 'Platina'; if (pct >= 70) return 'Ouro'; if (pct >= 40) return 'Prata'; return 'Bronze'; };
const getLevelClass = (l) => l.toLowerCase();
const levelColors = { bronze: '#CD7F32', prata: '#C0C0C0', ouro: '#FFD700', platina: '#E5E4E2', diamante: '#B9F2FF' };

const toNumber = (val) => { if (val === null || val === undefined) return 0; const n = val.toString().replace(/[^0-9,.\-]/g, '').replace(',', '.'); const p = parseFloat(n); return isNaN(p) ? 0 : p; };

const monthNames = { '01': 'Jan', '02': 'Fev', '03': 'Mar', '04': 'Abr', '05': 'Mai', '06': 'Jun', '07': 'Jul', '08': 'Ago', '09': 'Set', '10': 'Out', '11': 'Nov', '12': 'Dez' };
const fmtMonth = (s) => { if (!s) return ''; const p = s.split('-'); return p.length === 2 ? `${monthNames[p[1]] || p[1]}/${p[0]}` : s; };

const getToday = () => { const d = new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; };
const daysDiff = (dateStr) => { if (!dateStr) return 999; const d = new Date(dateStr + 'T00:00:00'); const now = new Date(); now.setHours(0,0,0,0); return Math.floor((now - d) / 86400000); };
const getVendorThermal = (statusObj) => {
  if (!statusObj || !statusObj.lastSaleDate) return 'freezing';
  const diff = daysDiff(statusObj.lastSaleDate);
  if (diff === 0) return 'fire';
  if (diff >= 2) return 'freezing';
  return 'normal';
};
const thermalEmoji = { fire: 'üî•', freezing: 'ü•∂', normal: '' };
const thermalLabel = { fire: 'Pegando Fogo!', freezing: 'Congelando...', normal: '' };

const achievements = [
  { icon: 'üî•', name: 'Em Chamas', desc: '7 dias consecutivos batendo meta', locked: false },
  { icon: '‚ö°', name: 'Rel√¢mpago', desc: '10 contratos em 1 dia', locked: false },
  { icon: 'üöÄ', name: 'Foguete', desc: 'Bater 150% da meta mensal', locked: true },
  { icon: 'üëë', name: 'Rei/Rainha', desc: '#1 do ranking por 3 meses', locked: true },
  { icon: 'üíé', name: 'Diamante Bruto', desc: 'Maior contrato do m√™s', locked: false },
  { icon: 'üéØ', name: 'Atirador de Elite', desc: '95%+ de convers√£o', locked: true },
  { icon: 'üèÜ', name: 'Campe√£o', desc: 'Bater meta 12 meses seguidos', locked: true },
  { icon: '‚≠ê', name: 'Estrela Cadente', desc: 'Crescimento de 200% em 1 m√™s', locked: true }
];

// ==================== MAIN COMPONENT ====================
function LeCardDashboard() {
  const [state, setState] = useState(null);
  const [page, setPage] = useState('dashboard');
  const [editMode, setEditMode] = useState(false);
  const [loading, setLoading] = useState(true);
  const [syncStatus, setSyncStatus] = useState('connecting');
  const [toast, setToast] = useState(null);
  const [settingsOpen, setSettingsOpen] = useState(false);
  const [sidebarHidden, setSidebarHidden] = useState(false);

  // Sync control refs
  const deviceId = useRef(`dev_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`);
  const lastSavedVersion = useRef(0);
  const isSaving = useRef(false);
  const pendingSave = useRef(null);
  const skipNextSSE = useRef(false);

  const showToast = useCallback((msg, type = 'success') => {
    setToast({ msg, type }); setTimeout(() => setToast(null), 3000);
  }, []);

  // ==================== FIREBASE SYNC ====================
  // Save to Firebase with device stamp and version
  const saveToFirebase = useCallback(async (newState) => {
    if (isSaving.current) {
      pendingSave.current = newState;
      return;
    }
    isSaving.current = true;
    setSyncStatus('syncing');
    const version = Date.now();
    lastSavedVersion.current = version;
    skipNextSSE.current = true;
    const payload = { ...newState, _meta: { deviceId: deviceId.current, version } };
    try {
      await fbSet('state', payload);
      setSyncStatus('connected');
    } catch {
      setSyncStatus('offline');
    } finally {
      isSaving.current = false;
      // Process queued save
      if (pendingSave.current) {
        const queued = pendingSave.current;
        pendingSave.current = null;
        saveToFirebase(queued);
      }
    }
  }, []);

  // Initial load
  useEffect(() => {
    (async () => {
      try {
        const data = await fbGet('state');
        if (data && data.data && data.data.rows) {
          const { _meta, ...clean } = data;
          if (_meta?.version) lastSavedVersion.current = _meta.version;
          setState(clean);
        } else {
          await fbSet('state', { ...defaultState, _meta: { deviceId: deviceId.current, version: Date.now() } });
          setState(defaultState);
        }
        setSyncStatus('connected');
      } catch {
        setState(defaultState);
        setSyncStatus('offline');
      } finally { setLoading(false); }
    })();
  }, []);

  // SSE listener ‚Äî Firebase sends 'put' and 'patch' events, NOT 'message'
  useEffect(() => {
    let es;
    let reconnectTimer;
    let pollTimer;

    const processRemoteData = (d) => {
      if (!d || !d.data || !d.data.rows) return;
      const meta = d._meta || {};
      // Skip if this is our own save echoing back
      if (meta.deviceId === deviceId.current && meta.version <= lastSavedVersion.current) {
        skipNextSSE.current = false;
        return;
      }
      if (skipNextSSE.current) {
        skipNextSSE.current = false;
        return;
      }
      // This is a REMOTE change ‚Äî apply it
      const { _meta, ...clean } = d;
      if (meta.version) lastSavedVersion.current = meta.version;
      setSyncStatus('syncing');
      setState(clean);
      setTimeout(() => setSyncStatus('connected'), 800);
    };

    const connect = () => {
      try {
        es = new EventSource(`${FIREBASE_DB_URL}/state.json`);

        // Firebase SSE sends 'put' events with { path, data } format
        es.addEventListener('put', (e) => {
          try {
            const parsed = JSON.parse(e.data);
            // When path is "/", data is the full state object
            if (parsed.path === '/') {
              processRemoteData(parsed.data);
            }
          } catch {}
        });

        // Also handle 'patch' events (partial updates)
        es.addEventListener('patch', (e) => {
          try {
            // On patch, do a full refetch to stay in sync
            fbGet('state').then(data => {
              if (data) {
                const { _meta, ...clean } = data;
                processRemoteData(data);
              }
            });
          } catch {}
        });

        es.onerror = () => {
          setSyncStatus('reconnecting');
          if (es) es.close();
          reconnectTimer = setTimeout(connect, 3000);
        };
        es.onopen = () => setSyncStatus('connected');
      } catch { 
        setSyncStatus('offline');
        // Fallback: poll every 5 seconds if SSE fails
        pollTimer = setInterval(async () => {
          try {
            const data = await fbGet('state');
            if (data) processRemoteData(data);
          } catch {}
        }, 5000);
      }
    };
    connect();

    // Fallback polling every 4 seconds (catches cases where SSE silently fails)
    pollTimer = setInterval(async () => {
      try {
        const data = await fbGet('state');
        if (data) processRemoteData(data);
        if (syncStatus === 'reconnecting' || syncStatus === 'offline') setSyncStatus('connected');
      } catch {}
    }, 4000);

    return () => { 
      if (es) es.close(); 
      clearTimeout(reconnectTimer); 
      clearInterval(pollTimer);
    };
  }, []);

  if (loading || !state) return (
    <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', background: '#111827', fontFamily: "'Inter',sans-serif" }}>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
      <div style={{ textAlign: 'center' }}>
        <div style={{ width: 50, height: 50, margin: '0 auto 16px', border: '4px solid rgba(252,211,77,0.2)', borderTopColor: '#FCD34D', borderRadius: '50%', animation: 'spin 1s linear infinite' }} />
        <p style={{ color: '#FCD34D', fontSize: 16, fontWeight: 600 }}>Conectando ao Firebase...</p>
        <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>
      </div>
    </div>
  );

  // ==================== COMPUTED VALUES ====================
  const rows = state.data?.rows || [];
  const goals = state.goals || defaultState.goals;
  const projections = state.projections || defaultState.projections;
  const cardVals = state.cardValues || {};
  const photos = state.photos || {};

  const totals = rows.reduce((a, r) => ({
    contracts: a.contracts + (parseFloat(r.Contratos) || 0),
    revenue: a.revenue + (parseFloat(r.Faturamento) || 0),
    cards: a.cards + (parseFloat(r.Cartoes) || 0)
  }), { contracts: 0, revenue: 0, cards: 0 });

  const numVendors = rows.length;
  const sectorGoals = { contracts: 15 * numVendors, revenue: 297000 * numVendors, cards: 540 * numVendors };
  const achRevenue = sectorGoals.revenue ? ((totals.revenue / sectorGoals.revenue) * 100).toFixed(1) : '0.0';
  const achContracts = sectorGoals.contracts ? ((totals.contracts / sectorGoals.contracts) * 100).toFixed(1) : '0.0';

  const revenueVal = cardVals.revenue ?? totals.revenue;
  const contractsVal = cardVals.contracts ?? totals.contracts;
  const cardsVal = cardVals.cards ?? totals.cards;
  const defTicket = contractsVal ? (revenueVal / contractsVal) : (totals.contracts ? (totals.revenue / totals.contracts) : 0);
  const ticketVal = cardVals.ticketMedio ?? defTicket;

  const ranking = [...rows].sort((a, b) => (parseFloat(b.Faturamento) || 0) - (parseFloat(a.Faturamento) || 0));

  // ==================== STATE UPDATERS ====================
  const updateState = (fn) => {
    setState(prev => {
      const next = JSON.parse(JSON.stringify(prev));
      fn(next);
      // Schedule save outside of setState
      setTimeout(() => saveToFirebase(next), 0);
      return next;
    });
  };

  const editPrompt = (label, current) => {
    const input = window.prompt(label, current);
    if (input === null) return null;
    return toNumber(input);
  };

  const editCardValue = (field) => {
    if (!editMode) return;
    const current = cardVals[field] ?? (field === 'revenue' ? totals.revenue : field === 'contracts' ? totals.contracts : field === 'cards' ? totals.cards : defTicket);
    const v = editPrompt(`Novo valor para ${field}:`, current);
    if (v === null) return;
    updateState(s => { if (!s.cardValues) s.cardValues = {}; s.cardValues[field] = v; });
  };

  const editSeller = (origIndex, field) => {
    if (!editMode) return;
    const seller = rows[origIndex];
    if (!seller) return;
    const current = seller[field];
    const input = window.prompt(`Novo valor para ${field} de ${seller.Nome}:`, current);
    if (input === null) return;
    const newVal = ['Contratos', 'Faturamento', 'Cartoes', 'Badges'].includes(field) ? toNumber(input) : input.trim();
    updateState(s => {
      s.data.rows[origIndex][field] = newVal;
      // Auto-register sale date when contracts increase
      if (field === 'Contratos' && newVal > (parseFloat(seller.Contratos) || 0)) {
        if (!s.vendorStatus) s.vendorStatus = {};
        s.vendorStatus[origIndex] = { lastSaleDate: getToday() };
      }
    });
    showToast(`${seller.Nome} atualizado!`);
  };

  const addVendor = () => {
    const name = window.prompt('Nome do novo vendedor:');
    if (!name || !name.trim()) return;
    const contratos = toNumber(window.prompt('Contratos iniciais:', '0'));
    const faturamento = toNumber(window.prompt('Faturamento inicial (R$):', '0'));
    const cartoes = toNumber(window.prompt('Cart√µes iniciais:', '0'));
    const badges = Math.round(toNumber(window.prompt('Badges iniciais:', '0')));
    const pct = (faturamento / 297000) * 100;
    const nivel = getLevel(pct);
    updateState(s => {
      s.data.rows.push({ Nome: name.trim(), Contratos: contratos, Faturamento: faturamento, Cartoes: cartoes, Nivel: nivel, Badges: badges });
    });
    showToast(`${name.trim()} adicionado!`);
  };

  const deleteVendor = (index) => {
    if (!window.confirm(`Excluir ${rows[index]?.Nome}?`)) return;
    const name = rows[index]?.Nome;
    updateState(s => {
      s.data.rows.splice(index, 1);
      // Reindex photos
      const np = {};
      Object.keys(s.photos || {}).forEach(k => { const ki = parseInt(k); if (ki < index) np[ki] = s.photos[k]; else if (ki > index) np[ki - 1] = s.photos[k]; });
      s.photos = np;
    });
    showToast(`${name} removido`, 'warning');
  };

  const editGoal = (path) => {
    if (!editMode) return;
    const keys = path.split('.');
    let current = state;
    keys.forEach(k => { current = current?.[k]; });
    const v = editPrompt(`Novo valor para ${path}:`, current);
    if (v === null) return;
    updateState(s => {
      let obj = s;
      for (let i = 0; i < keys.length - 1; i++) { if (!obj[keys[i]]) obj[keys[i]] = {}; obj = obj[keys[i]]; }
      obj[keys[keys.length - 1]] = v;
    });
  };

  const editVendorMonthlyKPIs = (index) => {
    const month = window.prompt('M√™s (YYYY-MM):', '2026-03');
    if (!month) return;
    const parts = month.split('-');
    const normalized = parts.length === 2 ? `${parts[0]}-${parts[1].padStart(2, '0')}` : month;
    const vkpis = state.vendorMonthlyKPIs || {};
    const current = vkpis[index]?.[normalized] || { revenue: 0, contracts: 0, cards: 0 };
    const input = window.prompt(`Faturamento, Contratos, Cart√µes para ${fmtMonth(normalized)} (separados por v√≠rgula):`, `${current.revenue}, ${current.contracts}, ${current.cards}`);
    if (!input) return;
    const p = input.split(',');
    updateState(s => {
      if (!s.vendorMonthlyKPIs) s.vendorMonthlyKPIs = {};
      if (!s.vendorMonthlyKPIs[index]) s.vendorMonthlyKPIs[index] = {};
      s.vendorMonthlyKPIs[index][normalized] = { revenue: toNumber(p[0]), contracts: toNumber(p[1]), cards: toNumber(p[2]) };
      recalcMonthlyTotals(s);
    });
    showToast('KPIs atualizados!');
  };

  const recalcMonthlyTotals = (s) => {
    const computed = {};
    if (s.vendorMonthlyKPIs) {
      Object.values(s.vendorMonthlyKPIs).forEach(vd => {
        Object.entries(vd || {}).forEach(([m, d]) => {
          if (!computed[m]) computed[m] = { revenue: 0, contracts: 0, cards: 0 };
          computed[m].revenue += parseFloat(d?.revenue) || 0;
          computed[m].contracts += parseFloat(d?.contracts) || 0;
          computed[m].cards += parseFloat(d?.cards) || 0;
        });
      });
    }
    const allMonths = new Set([...Object.keys(computed), ...Object.keys(s.monthlyKPIs || {})]);
    const updated = {};
    allMonths.forEach(m => {
      const me = s.monthlyKPIs?.[m] || { revenue: 0, contracts: 0, cards: 0, manual: {} };
      const manual = me.manual || {};
      const comp = computed[m] || { revenue: 0, contracts: 0, cards: 0 };
      updated[m] = {
        revenue: manual.revenue ? me.revenue : comp.revenue,
        contracts: manual.contracts ? me.contracts : comp.contracts,
        cards: manual.cards ? me.cards : comp.cards,
        manual
      };
    });
    s.monthlyKPIs = updated;
  };

  const addMonth = () => {
    const months = Object.keys(state.monthlyKPIs || {}).sort();
    let next;
    if (months.length === 0) { next = '2026-01'; }
    else {
      const last = months[months.length - 1].split('-');
      let y = parseInt(last[0]), m = parseInt(last[1]) + 1;
      if (m > 12) { m = 1; y++; }
      if (y > 2026) { showToast('N√£o √© poss√≠vel adicionar al√©m de 2026.', 'error'); return; }
      next = `${y}-${String(m).padStart(2, '0')}`;
    }
    updateState(s => {
      if (!s.monthlyKPIs) s.monthlyKPIs = {};
      if (!s.monthlyKPIs[next]) s.monthlyKPIs[next] = { revenue: 0, contracts: 0, cards: 0, manual: {} };
      if (!s.vendorMonthlyKPIs) s.vendorMonthlyKPIs = {};
      for (let i = 0; i < s.data.rows.length; i++) {
        if (!s.vendorMonthlyKPIs[i]) s.vendorMonthlyKPIs[i] = {};
        if (!s.vendorMonthlyKPIs[i][next]) s.vendorMonthlyKPIs[i][next] = { revenue: 0, contracts: 0, cards: 0 };
      }
      recalcMonthlyTotals(s);
    });
    showToast(`${fmtMonth(next)} adicionado!`);
  };

  const editMonthKPI = (month, field) => {
    if (!editMode) return;
    const current = state.monthlyKPIs?.[month]?.[field] || 0;
    const v = editPrompt(`Novo ${field} para ${fmtMonth(month)}:`, current);
    if (v === null) return;
    updateState(s => {
      if (!s.monthlyKPIs[month]) s.monthlyKPIs[month] = { revenue: 0, contracts: 0, cards: 0, manual: {} };
      if (!s.monthlyKPIs[month].manual) s.monthlyKPIs[month].manual = {};
      s.monthlyKPIs[month].manual[field] = true;
      s.monthlyKPIs[month][field] = v;
    });
  };

  const uploadPhoto = (index) => {
    if (!editMode) return;
    const input = document.createElement('input');
    input.type = 'file'; input.accept = 'image/*';
    input.onchange = (e) => {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = () => { updateState(s => { if (!s.photos) s.photos = {}; s.photos[index] = reader.result; }); showToast('Foto atualizada!'); };
      reader.readAsDataURL(file);
    };
    input.click();
  };

  const registerSale = (index) => {
    const seller = rows[index];
    if (!seller) return;
    updateState(s => {
      if (!s.vendorStatus) s.vendorStatus = {};
      s.vendorStatus[index] = { lastSaleDate: getToday() };
    });
    showToast(`üî• ${seller.Nome} est√° pegando fogo! Venda registrada hoje!`);
  };

  const setNormal = (index) => {
    const seller = rows[index];
    if (!seller) return;
    // Set lastSaleDate to yesterday so it's neither fire (today) nor freezing (2+ days)
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yStr = `${yesterday.getFullYear()}-${String(yesterday.getMonth()+1).padStart(2,'0')}-${String(yesterday.getDate()).padStart(2,'0')}`;
    updateState(s => {
      if (!s.vendorStatus) s.vendorStatus = {};
      s.vendorStatus[index] = { lastSaleDate: yStr };
    });
    showToast(`‚úÖ ${seller.Nome} voltou ao normal.`);
  };

  const setFreezing = (index) => {
    const seller = rows[index];
    if (!seller) return;
    // Set lastSaleDate to 3 days ago to trigger freezing (2+ days)
    const threeDaysAgo = new Date();
    threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
    const dStr = `${threeDaysAgo.getFullYear()}-${String(threeDaysAgo.getMonth()+1).padStart(2,'0')}-${String(threeDaysAgo.getDate()).padStart(2,'0')}`;
    updateState(s => {
      if (!s.vendorStatus) s.vendorStatus = {};
      s.vendorStatus[index] = { lastSaleDate: dStr };
    });
    showToast(`ü•∂ ${seller.Nome} est√° congelando...`);
  };

  // ==================== STYLES ====================
  const colors = {
    yellow: state.customizations?.colors?.['lecard-yellow'] || '#FCD34D',
    gold: state.customizations?.colors?.['lecard-gold'] || '#F59E0B',
    dark: '#1F2937', darker: '#111827',
    success: '#10B981', error: '#EF4444', info: '#3B82F6',
    bronze: '#CD7F32', silver: '#C0C0C0', goldM: '#FFD700', platinum: '#E5E4E2', diamond: '#B9F2FF'
  };

  const cardStyle = {
    background: 'linear-gradient(135deg, rgba(31,41,55,0.8), rgba(17,24,39,0.8))',
    backdropFilter: 'blur(10px)', borderRadius: 20, padding: 28,
    border: '1px solid rgba(252,211,77,0.1)', position: 'relative', overflow: 'hidden', transition: 'all 0.3s'
  };

  const editable = editMode ? { cursor: 'pointer', textDecoration: 'underline', textDecorationColor: colors.yellow } : {};

  // ==================== EDITABLE TEXT SYSTEM ====================
  const t = (key, fallback) => {
    return state.customizations?.texts?.[key] || fallback;
  };

  const saveText = (key, value) => {
    updateState(s => {
      if (!s.customizations) s.customizations = { texts: {}, colors: {}, logo: '' };
      if (!s.customizations.texts) s.customizations.texts = {};
      s.customizations.texts[key] = value;
    });
  };

  const EditableText = ({ k, fallback, tag, style: s = {} }) => {
    const [editing, setEditing] = useState(false);
    const [val, setVal] = useState('');
    const ref = useRef(null);

    const text = t(k, fallback);
    const Tag = tag || 'span';

    const startEditing = () => {
      if (!editMode) return;
      setVal(text);
      setEditing(true);
      setTimeout(() => ref.current?.focus(), 30);
    };

    const save = () => {
      const trimmed = val.trim();
      if (trimmed && trimmed !== fallback) {
        saveText(k, trimmed);
      } else {
        // Remove override, revert to default
        updateState(st => {
          if (st.customizations?.texts?.[k]) delete st.customizations.texts[k];
        });
      }
      setEditing(false);
    };

    if (editing) {
      return (
        <input ref={ref} value={val} onChange={e => setVal(e.target.value)}
          onBlur={save} onKeyDown={e => { if (e.key === 'Enter') save(); if (e.key === 'Escape') setEditing(false); }}
          style={{
            background: 'rgba(252,211,77,0.12)', border: `2px solid ${colors.yellow}`, borderRadius: 8,
            color: colors.yellow, fontSize: 'inherit', fontWeight: 'inherit', fontFamily: 'inherit',
            padding: '4px 10px', outline: 'none', width: '100%', boxSizing: 'border-box', ...s
          }}
        />
      );
    }

    return (
      <Tag onClick={startEditing} style={{
        ...s,
        ...(editMode ? { cursor: 'pointer', outline: '1px dashed rgba(252,211,77,0.4)', outlineOffset: 4, borderRadius: 4, transition: 'outline 0.2s' } : {})
      }} title={editMode ? `Clique para editar: "${k}"` : undefined}>
        {text}
      </Tag>
    );
  };

  // ==================== RENDER HELPERS ====================
  const Medal = ({ pos }) => pos === 1 ? 'ü•á' : pos === 2 ? 'ü•à' : pos === 3 ? 'ü•â' : 'üèÖ';

  const LevelBadge = ({ level }) => {
    const lc = getLevelClass(level);
    const c = levelColors[lc] || '#CD7F32';
    return <span style={{ display: 'inline-flex', alignItems: 'center', gap: 6, padding: '4px 12px', borderRadius: 20, fontSize: 11, fontWeight: 700, textTransform: 'uppercase', background: `${c}33`, color: c, border: `1px solid ${c}` }}>{level}</span>;
  };

  const StatCard = ({ icon, label, value, subtitle, progress, onClick }) => (
    <div style={cardStyle}>
      <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: 4, background: `linear-gradient(90deg, ${colors.yellow}, ${colors.gold})` }} />
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20 }}>
        <div style={{ width: 48, height: 48, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, borderRadius: 12, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 24 }}>{icon}</div>
        {progress !== undefined && <span style={{ padding: '6px 12px', borderRadius: 20, fontSize: 12, fontWeight: 700, background: 'rgba(16,185,129,0.2)', color: colors.success }}>‚Üë {progress}%</span>}
      </div>
      <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.6)', fontWeight: 600, textTransform: 'uppercase', letterSpacing: 0.5, marginBottom: 8 }}>{label}</div>
      <div onClick={onClick} style={{ fontSize: 42, fontWeight: 900, lineHeight: 1, marginBottom: 12, background: 'linear-gradient(135deg, white, rgba(255,255,255,0.8))', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', ...editable }}>{value}</div>
      {subtitle && <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.5)' }}>{subtitle}</div>}
    </div>
  );

  const ProgressBar = ({ pct, label1, label2 }) => (
    <div style={{ marginTop: 16 }}>
      <div style={{ height: 8, background: 'rgba(255,255,255,0.1)', borderRadius: 10, overflow: 'hidden' }}>
        <div style={{ height: '100%', width: `${Math.min(pct, 100)}%`, background: `linear-gradient(90deg, ${colors.yellow}, ${colors.gold})`, borderRadius: 10, transition: 'width 1s' }} />
      </div>
      <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: 8, fontSize: 12, color: 'rgba(255,255,255,0.6)' }}>
        <span>{label1}</span><span>{label2}</span>
      </div>
    </div>
  );

  const RankingItem = ({ seller, position, origIndex }) => {
    const pctInd = ((seller.Faturamento / 297000) * 100).toFixed(1);
    const level = getLevel(parseFloat(pctInd));
    const photo = photos[origIndex] || `https://ui-avatars.com/api/?name=${encodeURIComponent(seller.Nome)}&background=FCD34D&color=1F2937&size=100`;
    const rankBg = position === 1 ? 'rgba(255,215,0,0.1)' : position === 2 ? 'rgba(192,192,192,0.1)' : position === 3 ? 'rgba(205,127,50,0.1)' : 'rgba(255,255,255,0.03)';
    const rankBorder = position === 1 ? colors.goldM : position === 2 ? colors.silver : position === 3 ? colors.bronze : 'rgba(255,255,255,0.05)';

    const vendorSt = (state.vendorStatus || {})[origIndex];
    const thermal = getVendorThermal(vendorSt);
    const isFire = thermal === 'fire';
    const isFreeze = thermal === 'freezing';
    const thermalClass = isFire ? 'fire-item' : isFreeze ? 'freeze-item' : '';
    const lastDate = vendorSt?.lastSaleDate;
    const daysAgo = lastDate ? daysDiff(lastDate) : null;

    return (
      <div className={thermalClass} style={{
        display: 'grid', gridTemplateColumns: '60px 80px 1fr 120px 120px 120px 80px', gap: 20, alignItems: 'center', padding: 20,
        background: isFire ? 'linear-gradient(135deg, rgba(255,68,0,0.15), rgba(255,136,0,0.08))' : isFreeze ? 'linear-gradient(135deg, rgba(0,128,255,0.12), rgba(0,191,255,0.06))' : rankBg,
        borderRadius: 16, border: `1px solid ${isFire ? '#ff6600' : isFreeze ? '#00bfff' : rankBorder}`, marginBottom: 12, transition: 'all 0.3s', position: 'relative', overflow: 'hidden'
      }}>
        {/* Fire/Freeze overlay gradient */}
        {isFire && <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', background: 'linear-gradient(180deg, rgba(255,68,0,0.08) 0%, transparent 50%)', pointerEvents: 'none' }} />}
        {isFreeze && <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', background: 'linear-gradient(180deg, rgba(0,191,255,0.06) 0%, transparent 50%)', pointerEvents: 'none' }} />}

        <div style={{ fontSize: 32, fontWeight: 900, textAlign: 'center', color: position <= 3 ? rankBorder : 'white', position: 'relative', zIndex: 1 }}>{position}¬∫</div>

        <div style={{ position: 'relative', zIndex: 1 }}>
          <img src={photo} alt={seller.Nome} onClick={() => uploadPhoto(origIndex)} style={{
            width: 60, height: 60, borderRadius: '50%', objectFit: 'cover',
            border: `3px solid ${isFire ? '#ff6600' : isFreeze ? '#00bfff' : colors.yellow}`,
            cursor: editMode ? 'pointer' : 'default',
            boxShadow: isFire ? '0 0 12px rgba(255,100,0,0.5)' : isFreeze ? '0 0 12px rgba(0,191,255,0.4)' : 'none'
          }} />
          {/* Thermal emoji floating on avatar */}
          {(isFire || isFreeze) && (
            <span className={isFire ? 'fire-emoji' : 'freeze-emoji'} style={{ position: 'absolute', top: -8, right: -8, fontSize: 22, zIndex: 2 }}>
              {thermalEmoji[thermal]}
            </span>
          )}
        </div>

        <div style={{ position: 'relative', zIndex: 1 }}>
          <div style={{ fontSize: 18, fontWeight: 700, ...editable, display: 'flex', alignItems: 'center', flexWrap: 'wrap', gap: 6 }} onClick={() => editSeller(origIndex, 'Nome')}>
            {seller.Nome}
            {/* Thermal status badge */}
            {isFire && (
              <span className="fire-badge" style={{ fontSize: 10, fontWeight: 800, padding: '3px 10px', borderRadius: 20, textTransform: 'uppercase', letterSpacing: 1, marginLeft: 4 }}>
                üî• <EditableText k="badge.fire" fallback="Pegando Fogo!" />
              </span>
            )}
            {isFreeze && (
              <span className="freeze-badge" style={{ fontSize: 10, fontWeight: 800, padding: '3px 10px', borderRadius: 20, textTransform: 'uppercase', letterSpacing: 1, marginLeft: 4 }}>
                ü•∂ <EditableText k="badge.freeze" fallback="Congelando" />
              </span>
            )}
            <span onClick={(e) => { e.stopPropagation(); editVendorMonthlyKPIs(origIndex); }} style={{ marginLeft: 6, cursor: 'pointer', fontSize: 14, color: colors.yellow }} title="Editar KPIs mensais">üìÖ</span>
            {editMode && <span onClick={(e) => { e.stopPropagation(); deleteVendor(origIndex); }} style={{ marginLeft: 6, cursor: 'pointer', fontSize: 14, color: colors.error }} title="Excluir">üóëÔ∏è</span>}
          </div>
          <div style={{ fontSize: 12, color: colors.yellow, fontWeight: 600, display: 'flex', alignItems: 'center', gap: 6, marginTop: 4, flexWrap: 'wrap' }}>
            <LevelBadge level={level} />
            <span style={editable} onClick={() => editSeller(origIndex, 'Badges')}>{seller.Badges || 0} badges</span>
            {daysAgo !== null && <span style={{ fontSize: 10, color: 'rgba(255,255,255,0.4)' }}>‚Ä¢ {daysAgo === 0 ? t('rank.vendeuHoje','Vendeu hoje') : daysAgo === 1 ? `1 ${t('rank.diaSemVenda','dia sem venda')}` : `${daysAgo} ${t('rank.diasSemVenda','dias sem venda')}`}</span>}
          </div>
          {/* Status buttons */}
          <div style={{ marginTop: 6, display: 'flex', gap: 6, flexWrap: 'wrap' }}>
            <button onClick={(e) => { e.stopPropagation(); registerSale(origIndex); }} style={{
              padding: '3px 10px', border: 'none', borderRadius: 8, fontSize: 11, fontWeight: 700, cursor: 'pointer',
              background: isFire ? 'rgba(255,100,0,0.3)' : 'rgba(255,100,0,0.1)',
              color: isFire ? '#ffaa00' : '#ff8800',
              outline: isFire ? '2px solid #ff6600' : 'none',
              transition: 'all 0.2s'
            }} title="Vendeu hoje">
              üî• <EditableText k="status.fire" fallback="Pegando Fogo" />
            </button>
            <button onClick={(e) => { e.stopPropagation(); setNormal(origIndex); }} style={{
              padding: '3px 10px', border: 'none', borderRadius: 8, fontSize: 11, fontWeight: 700, cursor: 'pointer',
              background: (!isFire && !isFreeze) ? 'rgba(16,185,129,0.3)' : 'rgba(16,185,129,0.1)',
              color: (!isFire && !isFreeze) ? '#34d399' : '#10B981',
              outline: (!isFire && !isFreeze) ? '2px solid #10B981' : 'none',
              transition: 'all 0.2s'
            }} title="Definir como normal">
              ‚úÖ <EditableText k="status.normal" fallback="Normal" />
            </button>
            <button onClick={(e) => { e.stopPropagation(); setFreezing(origIndex); }} style={{
              padding: '3px 10px', border: 'none', borderRadius: 8, fontSize: 11, fontWeight: 700, cursor: 'pointer',
              background: isFreeze ? 'rgba(0,191,255,0.3)' : 'rgba(0,191,255,0.1)',
              color: isFreeze ? '#80dfff' : '#00bfff',
              outline: isFreeze ? '2px solid #00bfff' : 'none',
              transition: 'all 0.2s'
            }} title="Marcar como congelando">
              ü•∂ <EditableText k="status.freeze" fallback="Congelando" />
            </button>
          </div>
        </div>

        <div style={{ textAlign: 'center', position: 'relative', zIndex: 1 }}>
          <div style={{ fontSize: 20, fontWeight: 800, color: isFire ? '#ff8800' : isFreeze ? '#80dfff' : colors.yellow, ...editable }} onClick={() => editSeller(origIndex, 'Contratos')}>{seller.Contratos}</div>
          <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.5)', textTransform: 'uppercase' }}>{t('rank.lbl.contratos','Contratos')}</div>
        </div>
        <div style={{ textAlign: 'center', position: 'relative', zIndex: 1 }}>
          <div style={{ fontSize: 20, fontWeight: 800, color: isFire ? '#ff8800' : isFreeze ? '#80dfff' : colors.yellow, ...editable }} onClick={() => editSeller(origIndex, 'Faturamento')}>{formatCurrency(seller.Faturamento)}</div>
          <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.5)', textTransform: 'uppercase' }}>{t('rank.lbl.faturamento','Faturamento')}</div>
        </div>
        <div style={{ textAlign: 'center', position: 'relative', zIndex: 1 }}>
          <div style={{ fontSize: 20, fontWeight: 800, color: isFire ? '#ff8800' : isFreeze ? '#80dfff' : colors.yellow, ...editable }} onClick={() => editSeller(origIndex, 'Cartoes')}>{seller.Cartoes}</div>
          <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.5)', textTransform: 'uppercase' }}>{t('rank.lbl.cartoes','Cart√µes')}</div>
        </div>
        <div style={{ fontSize: 40, textAlign: 'center', position: 'relative', zIndex: 1 }}>
          {isFire ? <span className="fire-emoji" style={{ fontSize: 40 }}>üî•</span> : isFreeze ? <span className="freeze-emoji" style={{ fontSize: 40 }}>ü•∂</span> : <Medal pos={position} />}
        </div>
      </div>
    );
  };

  // ==================== PAGES ====================
  const DashboardPage = () => {
    const fireCount = rows.filter((_, i) => getVendorThermal((state.vendorStatus || {})[i]) === 'fire').length;
    const freezeCount = rows.filter((_, i) => getVendorThermal((state.vendorStatus || {})[i]) === 'freezing').length;
    const normalCount = rows.length - fireCount - freezeCount;

    return (
    <>
      <div style={{ marginBottom: 32 }}>
        <h1 style={{ fontSize: 36, fontWeight: 900, marginBottom: 8, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}><EditableText k="dash.title" fallback="Dashboard Real-Time" /></h1>
        <p style={{ fontSize: 16, color: 'rgba(255,255,255,0.6)' }}><EditableText k="dash.subtitle" fallback="Acompanhe o desempenho da equipe em tempo real" /></p>
      </div>

      {/* Thermal Status Summary */}
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 16, marginBottom: 24 }}>
        <div style={{ padding: '16px 20px', borderRadius: 16, background: 'linear-gradient(135deg, rgba(255,68,0,0.15), rgba(255,136,0,0.08))', border: '1px solid rgba(255,100,0,0.3)', display: 'flex', alignItems: 'center', gap: 12 }}>
          <span style={{ fontSize: 32 }}>üî•</span>
          <div>
            <div style={{ fontSize: 24, fontWeight: 900, color: '#ff8800' }}>{fireCount}</div>
            <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.6)', textTransform: 'uppercase', fontWeight: 700, letterSpacing: 1 }}><EditableText k="dash.fire" fallback="Pegando Fogo" /></div>
          </div>
        </div>
        <div style={{ padding: '16px 20px', borderRadius: 16, background: 'rgba(16,185,129,0.1)', border: '1px solid rgba(16,185,129,0.3)', display: 'flex', alignItems: 'center', gap: 12 }}>
          <span style={{ fontSize: 32 }}>‚úÖ</span>
          <div>
            <div style={{ fontSize: 24, fontWeight: 900, color: '#10B981' }}>{normalCount}</div>
            <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.6)', textTransform: 'uppercase', fontWeight: 700, letterSpacing: 1 }}><EditableText k="dash.normal" fallback="Normal" /></div>
          </div>
        </div>
        <div style={{ padding: '16px 20px', borderRadius: 16, background: 'linear-gradient(135deg, rgba(0,128,255,0.12), rgba(0,191,255,0.06))', border: '1px solid rgba(0,191,255,0.3)', display: 'flex', alignItems: 'center', gap: 12 }}>
          <span style={{ fontSize: 32 }}>ü•∂</span>
          <div>
            <div style={{ fontSize: 24, fontWeight: 900, color: '#00bfff' }}>{freezeCount}</div>
            <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.6)', textTransform: 'uppercase', fontWeight: 700, letterSpacing: 1 }}><EditableText k="dash.freeze" fallback="Congelando" /></div>
          </div>
        </div>
      </div>
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: 24, marginBottom: 32 }}>
        <div style={cardStyle}>
          <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: 4, background: `linear-gradient(90deg, ${colors.yellow}, ${colors.gold})` }} />
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20 }}>
            <div style={{ width: 48, height: 48, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, borderRadius: 12, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 24 }}>üí∞</div>
            <span style={{ padding: '6px 12px', borderRadius: 20, fontSize: 12, fontWeight: 700, background: 'rgba(16,185,129,0.2)', color: colors.success }}>‚Üë {achRevenue}%</span>
          </div>
          <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.6)', fontWeight: 600, textTransform: 'uppercase', marginBottom: 8 }}><EditableText k="dash.lbl.revenue" fallback="Faturamento Total" /></div>
          <div onClick={() => editCardValue('revenue')} style={{ fontSize: 42, fontWeight: 900, lineHeight: 1, marginBottom: 12, background: 'linear-gradient(135deg, white, rgba(255,255,255,0.8))', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', ...editable }}>{formatCurrency(revenueVal)}</div>
          <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.5)' }}><EditableText k="dash.meta.prefix" fallback="Meta:" /> {formatCurrency(sectorGoals.revenue)}</div>
          <ProgressBar pct={parseFloat(achRevenue)} label1={`${achRevenue}% ${t('dash.pct.meta','da meta')}`} label2={`${formatCurrency(sectorGoals.revenue - totals.revenue)} ${t('dash.restante','restante')}`} />
        </div>
        <div style={cardStyle}>
          <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: 4, background: `linear-gradient(90deg, ${colors.yellow}, ${colors.gold})` }} />
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20 }}>
            <div style={{ width: 48, height: 48, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, borderRadius: 12, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 24 }}>üìù</div>
            <span style={{ padding: '6px 12px', borderRadius: 20, fontSize: 12, fontWeight: 700, background: 'rgba(16,185,129,0.2)', color: colors.success }}>‚Üë {achContracts}%</span>
          </div>
          <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.6)', fontWeight: 600, textTransform: 'uppercase', marginBottom: 8 }}><EditableText k="dash.lbl.contracts" fallback="Contratos Fechados" /></div>
          <div onClick={() => editCardValue('contracts')} style={{ fontSize: 42, fontWeight: 900, lineHeight: 1, marginBottom: 12, background: 'linear-gradient(135deg, white, rgba(255,255,255,0.8))', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', ...editable }}>{formatNumber(contractsVal)}</div>
          <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.5)' }}><EditableText k="dash.meta.prefix" fallback="Meta:" /> {sectorGoals.contracts} <EditableText k="dash.lbl.contratosUnit" fallback="contratos" /></div>
          <ProgressBar pct={parseFloat(achContracts)} label1={`${achContracts}% ${t('dash.pct.meta','da meta')}`} label2={`${sectorGoals.contracts - totals.contracts} ${t('dash.faltam','faltam')}`} />
        </div>
        <StatCard icon="üí≥" label={<EditableText k="dash.lbl.cards" fallback="Cart√µes Emitidos" />} value={formatNumber(cardsVal)} subtitle={<><EditableText k="dash.meta.prefix" fallback="Meta:" /> {formatNumber(sectorGoals.cards)} <EditableText k="dash.lbl.cartoesUnit" fallback="cart√µes" /></>} onClick={() => editCardValue('cards')} />
        <StatCard icon="üéØ" label={<EditableText k="dash.lbl.ticket" fallback="Ticket M√©dio" />} value={formatCurrency(ticketVal)} subtitle={<EditableText k="dash.ticket.sub" fallback="Por contrato fechado" />} onClick={() => editCardValue('ticketMedio')} />
      </div>
      <div style={{ ...cardStyle, borderRadius: 24, padding: 32, marginBottom: 32 }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 32, paddingBottom: 20, borderBottom: `2px solid rgba(252,211,77,0.2)` }}>
          <h2 style={{ fontSize: 28, fontWeight: 900, display: 'flex', alignItems: 'center', gap: 12 }}>üèÜ <EditableText k="dash.ranking.title" fallback="Ranking LeCard" /></h2>
        </div>
        {ranking.slice(0, 10).map((seller, idx) => {
          const origIndex = rows.findIndex(r => r === seller);
          return <RankingItem key={origIndex} seller={seller} position={idx + 1} origIndex={origIndex} />;
        })}
      </div>
    </>
  );
  };

  const ProjectionsPage = () => (
    <>
      <div style={{ marginBottom: 32 }}>
        <h1 style={{ fontSize: 36, fontWeight: 900, marginBottom: 8, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}><EditableText k="proj.title" fallback="Proje√ß√µes 2026" /></h1>
        <p style={{ fontSize: 16, color: 'rgba(255,255,255,0.6)' }}><EditableText k="proj.subtitle" fallback="An√°lise de proje√ß√£o e metas do ano" /></p>
      </div>
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: 24, marginBottom: 32 }}>
        <StatCard icon="üéØ" label={<EditableText k="proj.lbl.meta" fallback="Meta 2026" />} value={formatCurrency(goals.meta2026)} subtitle={<EditableText k="proj.sub.meta" fallback="Objetivo anual" />} onClick={() => editGoal('goals.meta2026')} />
        <StatCard icon="üìä" label={<EditableText k="proj.lbl.base" fallback="Base 2025" />} value={formatCurrency(goals.base2025)} subtitle={<EditableText k="proj.sub.base" fallback="Contratos vindos de 2025" />} onClick={() => editGoal('goals.base2025')} />
        <StatCard icon="üìà" label={<EditableText k="proj.lbl.total" fallback="Proje√ß√£o Total" />} value={formatCurrency(projections.projecaoTotal)} subtitle={<EditableText k="proj.sub.total" fallback="Internos + Externos" />} onClick={() => editGoal('projections.projecaoTotal')} />
        <StatCard icon="‚ö†Ô∏è" label={<EditableText k="proj.lbl.gap" fallback="Gap para Meta" />} value={formatCurrency(goals.gap)} subtitle={<EditableText k="proj.sub.gap" fallback="Diferen√ßa a ser coberta" />} onClick={() => editGoal('goals.gap')} />
      </div>
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: 24 }}>
        <div style={cardStyle}>
          <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: 4, background: `linear-gradient(90deg, ${colors.yellow}, ${colors.gold})` }} />
          <div style={{ width: 48, height: 48, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, borderRadius: 12, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 24, marginBottom: 16 }}>üë•</div>
          <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.6)', fontWeight: 600, textTransform: 'uppercase', marginBottom: 8 }}><EditableText k="proj.lbl.internos" fallback="Vendedores Internos" /></div>
          <div onClick={() => editGoal('goals.vendedoresInternos')} style={{ fontSize: 42, fontWeight: 900, marginBottom: 12, background: 'linear-gradient(135deg, white, rgba(255,255,255,0.8))', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', ...editable }}>{goals.vendedoresInternos}</div>
          <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.5)' }}><EditableText k="proj.metaMensal" fallback="Meta mensal:" /> <span style={editable} onClick={() => editGoal('goals.metaMensalInterno')}>{formatCurrency(goals.metaMensalInterno)}</span></div>
          <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.5)', marginTop: 8 }}><EditableText k="proj.projAnual" fallback="Proje√ß√£o anual:" /> <span style={editable} onClick={() => editGoal('projections.internosTotal')}>{formatCurrency(projections.internosTotal)}</span></div>
        </div>
        <div style={cardStyle}>
          <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: 4, background: `linear-gradient(90deg, ${colors.yellow}, ${colors.gold})` }} />
          <div style={{ width: 48, height: 48, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, borderRadius: 12, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 24, marginBottom: 16 }}>üë•</div>
          <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.6)', fontWeight: 600, textTransform: 'uppercase', marginBottom: 8 }}><EditableText k="proj.lbl.externos" fallback="Vendedores Externos" /></div>
          <div onClick={() => editGoal('goals.vendedoresExternos')} style={{ fontSize: 42, fontWeight: 900, marginBottom: 12, background: 'linear-gradient(135deg, white, rgba(255,255,255,0.8))', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', ...editable }}>{goals.vendedoresExternos}</div>
          <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.5)' }}><EditableText k="proj.metaMensal" fallback="Meta mensal:" /> <span style={editable} onClick={() => editGoal('goals.metaMensalExterno')}>{formatCurrency(goals.metaMensalExterno)}</span></div>
          <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.5)', marginTop: 8 }}><EditableText k="proj.projAnual" fallback="Proje√ß√£o anual:" /> <span style={editable} onClick={() => editGoal('projections.externosTotal')}>{formatCurrency(projections.externosTotal)}</span></div>
        </div>
      </div>
    </>
  );

  const ArenaPage = () => (
    <>
      <div style={{ marginBottom: 32 }}>
        <h1 style={{ fontSize: 36, fontWeight: 900, marginBottom: 8, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}><EditableText k="arena.title" fallback="Arena Competitiva" /></h1>
        <p style={{ fontSize: 16, color: 'rgba(255,255,255,0.6)' }}><EditableText k="arena.subtitle" fallback="Conquistas, badges e competi√ß√µes" /></p>
      </div>
      <div style={{ ...cardStyle, borderRadius: 24, padding: 32, marginBottom: 32 }}>
        <h2 style={{ fontSize: 28, fontWeight: 900, marginBottom: 24, paddingBottom: 20, borderBottom: '2px solid rgba(252,211,77,0.2)' }}>üèÜ <EditableText k="arena.leaderboard" fallback="Leaderboard Completo" /></h2>
        {ranking.map((seller, idx) => {
          const origIndex = rows.findIndex(r => r === seller);
          return <RankingItem key={origIndex} seller={seller} position={idx + 1} origIndex={origIndex} />;
        })}
      </div>
      <div style={{ ...cardStyle, borderRadius: 24, padding: 32 }}>
        <h3 style={{ fontSize: 24, fontWeight: 900, marginBottom: 24 }}>üéñÔ∏è <EditableText k="arena.conquistas" fallback="Conquistas Dispon√≠veis" /></h3>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(180px, 1fr))', gap: 16 }}>
          {achievements.map((a, i) => (
            <div key={i} style={{ background: 'rgba(255,255,255,0.03)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: 12, padding: 20, textAlign: 'center', opacity: a.locked ? 0.4 : 1, filter: a.locked ? 'grayscale(1)' : 'none', transition: 'all 0.3s' }}>
              <div style={{ fontSize: 48, marginBottom: 12 }}>{a.icon}</div>
              <div style={{ fontSize: 14, fontWeight: 700, marginBottom: 4 }}><EditableText k={`ach.${i}.name`} fallback={a.name} /></div>
              <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.5)' }}><EditableText k={`ach.${i}.desc`} fallback={a.desc} /></div>
            </div>
          ))}
        </div>
      </div>
    </>
  );

  const MonthlyKPIsPage = () => {
    const months = Object.keys(state.monthlyKPIs || {}).sort();
    return (
      <>
        <div style={{ marginBottom: 32 }}>
          <h1 style={{ fontSize: 36, fontWeight: 900, marginBottom: 8, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}><EditableText k="kpi.title" fallback="KPIs Mensais" /></h1>
          <p style={{ fontSize: 16, color: 'rgba(255,255,255,0.6)' }}><EditableText k="kpi.subtitle" fallback="Registre e acompanhe os KPIs de cada m√™s" /></p>
        </div>
        <div style={{ ...cardStyle, borderRadius: 24, padding: 32, overflowX: 'auto' }}>
          <table style={{ width: '100%', borderCollapse: 'collapse' }}>
            <thead>
              <tr>
                {[
                  { k: 'kpi.col.mes', f: 'M√™s' }, { k: 'kpi.col.fat', f: 'Faturamento' },
                  { k: 'kpi.col.contr', f: 'Contratos' }, { k: 'kpi.col.cart', f: 'Cart√µes' }, { k: 'kpi.col.ticket', f: 'Ticket M√©dio' }
                ].map(h => (
                  <th key={h.k} style={{ padding: '12px 16px', borderBottom: '1px solid rgba(255,255,255,0.1)', textAlign: 'left', fontSize: 14, fontWeight: 600, textTransform: 'uppercase', background: 'rgba(255,255,255,0.1)', color: 'white' }}><EditableText k={h.k} fallback={h.f} /></th>
                ))}
              </tr>
            </thead>
            <tbody>
              {months.map(m => {
                const d = state.monthlyKPIs[m] || {};
                const ticket = d.contracts ? (d.revenue / d.contracts) : 0;
                return (
                  <tr key={m}>
                    <td style={{ padding: '12px 16px', borderBottom: '1px solid rgba(255,255,255,0.1)', background: 'rgba(31,41,55,0.8)' }}>{fmtMonth(m)}</td>
                    <td onClick={() => editMonthKPI(m, 'revenue')} style={{ padding: '12px 16px', borderBottom: '1px solid rgba(255,255,255,0.1)', background: 'rgba(31,41,55,0.8)', ...editable }}>{formatCurrency(d.revenue || 0)}</td>
                    <td onClick={() => editMonthKPI(m, 'contracts')} style={{ padding: '12px 16px', borderBottom: '1px solid rgba(255,255,255,0.1)', background: 'rgba(31,41,55,0.8)', ...editable }}>{formatNumber(d.contracts || 0)}</td>
                    <td onClick={() => editMonthKPI(m, 'cards')} style={{ padding: '12px 16px', borderBottom: '1px solid rgba(255,255,255,0.1)', background: 'rgba(31,41,55,0.8)', ...editable }}>{formatNumber(d.cards || 0)}</td>
                    <td style={{ padding: '12px 16px', borderBottom: '1px solid rgba(255,255,255,0.1)', background: 'rgba(31,41,55,0.8)' }}>{formatCurrency(ticket)}</td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
        <button onClick={addMonth} style={{ marginTop: 16, padding: '10px 20px', border: 'none', borderRadius: 12, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, color: colors.darker, fontWeight: 700, cursor: 'pointer', fontSize: 14 }}>‚ûï <EditableText k="kpi.btn.addMes" fallback="Adicionar M√™s" /></button>
      </>
    );
  };

  // ==================== SPREADSHEET PAGE ====================
  const SpreadsheetPage = () => {
    const [editCell, setEditCell] = useState(null); // { row, col }
    const [cellValue, setCellValue] = useState('');
    const cellRef = useRef(null);

    const columns = [
      { key: 'Nome', label: 'Nome', type: 'text', width: 160 },
      { key: 'Contratos', label: 'Contratos', type: 'number', width: 110 },
      { key: 'Faturamento', label: 'Faturamento (R$)', type: 'number', width: 160 },
      { key: 'Cartoes', label: 'Cart√µes', type: 'number', width: 110 },
      { key: 'Badges', label: 'Badges', type: 'number', width: 100 },
      { key: '_nivel', label: 'N√≠vel', type: 'computed', width: 120 },
      { key: '_ticketMedio', label: 'Ticket M√©dio', type: 'computed', width: 140 },
      { key: '_status', label: 'Status', type: 'status', width: 130 }
    ];

    const months = Object.keys(state.monthlyKPIs || {}).sort();
    const monthCols = [];
    months.forEach(m => {
      monthCols.push({ key: `_m_${m}_revenue`, label: `${fmtMonth(m)} Fat.`, type: 'monthKPI', month: m, field: 'revenue', width: 140 });
      monthCols.push({ key: `_m_${m}_contracts`, label: `${fmtMonth(m)} Contr.`, type: 'monthKPI', month: m, field: 'contracts', width: 130 });
      monthCols.push({ key: `_m_${m}_cards`, label: `${fmtMonth(m)} Cart.`, type: 'monthKPI', month: m, field: 'cards', width: 130 });
    });

    const allCols = [...columns, ...monthCols];

    const getCellValue = (rowIdx, col) => {
      const vendor = rows[rowIdx];
      if (!vendor) return '';
      if (col.key === '_nivel') {
        const pct = ((vendor.Faturamento / 297000) * 100);
        return getLevel(pct);
      }
      if (col.key === '_ticketMedio') {
        return vendor.Contratos ? formatCurrency(vendor.Faturamento / vendor.Contratos) : 'R$ 0';
      }
      if (col.key === '_status') {
        const thermal = getVendorThermal((state.vendorStatus || {})[rowIdx]);
        return thermal;
      }
      if (col.type === 'monthKPI') {
        const vkpi = (state.vendorMonthlyKPIs || {})[rowIdx];
        const mData = vkpi?.[col.month] || {};
        return mData[col.field] || 0;
      }
      return vendor[col.key] ?? '';
    };

    const getRawValue = (rowIdx, col) => {
      const vendor = rows[rowIdx];
      if (!vendor) return '';
      if (col.type === 'monthKPI') {
        const vkpi = (state.vendorMonthlyKPIs || {})[rowIdx];
        const mData = vkpi?.[col.month] || {};
        return mData[col.field] || 0;
      }
      return vendor[col.key] ?? '';
    };

    const formatDisplay = (val, col) => {
      if (col.key === '_nivel') return val;
      if (col.key === '_ticketMedio') return val;
      if (col.key === '_status') {
        if (val === 'fire') return `üî• ${t('badge.fire','Pegando Fogo!')}`;
        if (val === 'freezing') return `ü•∂ ${t('badge.freeze','Congelando')}`;
        return `‚úÖ ${t('status.normal','Normal')}`;
      }
      if (col.key === 'Faturamento' || (col.type === 'monthKPI' && col.field === 'revenue')) return formatCurrency(val);
      if (col.type === 'number' || col.type === 'monthKPI') return formatNumber(val);
      return val;
    };

    const startEdit = (row, colIdx) => {
      const col = allCols[colIdx];
      if (col.type === 'computed') return; // Can't edit computed
      if (col.key === '_status') return; // Status has buttons
      setEditCell({ row, col: colIdx });
      setCellValue(String(getRawValue(row, col)));
      setTimeout(() => cellRef.current?.focus(), 30);
    };

    const saveCell = () => {
      if (!editCell) return;
      const { row, col: colIdx } = editCell;
      const col = allCols[colIdx];

      if (col.type === 'monthKPI') {
        const newVal = toNumber(cellValue);
        updateState(s => {
          if (!s.vendorMonthlyKPIs) s.vendorMonthlyKPIs = {};
          if (!s.vendorMonthlyKPIs[row]) s.vendorMonthlyKPIs[row] = {};
          if (!s.vendorMonthlyKPIs[row][col.month]) s.vendorMonthlyKPIs[row][col.month] = { revenue: 0, contracts: 0, cards: 0 };
          s.vendorMonthlyKPIs[row][col.month][col.field] = newVal;
          // Recalc monthly totals
          const computed = {};
          if (s.vendorMonthlyKPIs) {
            Object.values(s.vendorMonthlyKPIs).forEach(vd => {
              Object.entries(vd || {}).forEach(([m, d]) => {
                if (!computed[m]) computed[m] = { revenue: 0, contracts: 0, cards: 0 };
                computed[m].revenue += parseFloat(d?.revenue) || 0;
                computed[m].contracts += parseFloat(d?.contracts) || 0;
                computed[m].cards += parseFloat(d?.cards) || 0;
              });
            });
          }
          const allMonths = new Set([...Object.keys(computed), ...Object.keys(s.monthlyKPIs || {})]);
          const updated = {};
          allMonths.forEach(m => {
            const me = s.monthlyKPIs?.[m] || { revenue: 0, contracts: 0, cards: 0, manual: {} };
            const manual = me.manual || {};
            const comp = computed[m] || { revenue: 0, contracts: 0, cards: 0 };
            updated[m] = { revenue: manual.revenue ? me.revenue : comp.revenue, contracts: manual.contracts ? me.contracts : comp.contracts, cards: manual.cards ? me.cards : comp.cards, manual };
          });
          s.monthlyKPIs = updated;
        });
      } else {
        const newVal = col.type === 'number' ? toNumber(cellValue) : cellValue.trim();
        updateState(s => {
          const oldContratos = parseFloat(s.data.rows[row].Contratos) || 0;
          s.data.rows[row][col.key] = newVal;
          // Auto-fire when contracts increase
          if (col.key === 'Contratos' && newVal > oldContratos) {
            if (!s.vendorStatus) s.vendorStatus = {};
            s.vendorStatus[row] = { lastSaleDate: getToday() };
          }
        });
      }
      setEditCell(null);
    };

    const handleKey = (e) => {
      if (e.key === 'Enter') { saveCell(); }
      else if (e.key === 'Escape') { setEditCell(null); }
      else if (e.key === 'Tab') {
        e.preventDefault();
        saveCell();
        // Move to next editable cell
        if (editCell) {
          let nextCol = editCell.col + 1;
          let nextRow = editCell.row;
          while (nextCol < allCols.length || nextRow < rows.length - 1) {
            if (nextCol >= allCols.length) { nextCol = 0; nextRow++; }
            if (nextRow >= rows.length) break;
            const c = allCols[nextCol];
            if (c.type !== 'computed' && c.key !== '_status') {
              setTimeout(() => startEdit(nextRow, nextCol), 50);
              return;
            }
            nextCol++;
          }
        }
      }
    };

    const thStyle = {
      padding: '10px 14px', fontSize: 11, fontWeight: 800, textTransform: 'uppercase', letterSpacing: 1,
      color: colors.darker, textAlign: 'left', whiteSpace: 'nowrap', position: 'sticky', top: 0, zIndex: 2,
      background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`,
      borderBottom: `2px solid ${colors.gold}`, userSelect: 'none'
    };

    const tdStyle = (rowIdx, colIdx) => {
      const isEditing = editCell?.row === rowIdx && editCell?.col === colIdx;
      const col = allCols[colIdx];
      const isComputed = col.type === 'computed';
      const isStatus = col.key === '_status';
      return {
        padding: isEditing ? '0' : '8px 14px',
        fontSize: 14, fontWeight: 600,
        borderBottom: '1px solid rgba(255,255,255,0.06)',
        borderRight: '1px solid rgba(255,255,255,0.04)',
        background: isEditing ? 'rgba(252,211,77,0.15)' : rowIdx % 2 === 0 ? 'rgba(31,41,55,0.8)' : 'rgba(17,24,39,0.8)',
        cursor: isComputed || isStatus ? 'default' : 'cell',
        color: isComputed ? 'rgba(255,255,255,0.5)' : 'white',
        whiteSpace: 'nowrap', transition: 'background 0.15s',
        textAlign: col.type === 'number' || col.type === 'monthKPI' || col.key === '_ticketMedio' ? 'right' : 'left',
        minWidth: col.width || 100
      };
    };

    const inputStyle = {
      width: '100%', height: '100%', padding: '8px 14px', border: `2px solid ${colors.yellow}`,
      borderRadius: 0, background: 'rgba(252,211,77,0.1)', color: colors.yellow,
      fontSize: 14, fontWeight: 700, fontFamily: 'inherit', outline: 'none',
      boxSizing: 'border-box'
    };

    const statusBg = (thermal) => {
      if (thermal === 'fire') return { bg: 'rgba(255,100,0,0.2)', color: '#ff8800', border: '#ff6600' };
      if (thermal === 'freezing') return { bg: 'rgba(0,191,255,0.2)', color: '#00bfff', border: '#00bfff' };
      return { bg: 'rgba(16,185,129,0.15)', color: '#10B981', border: '#10B981' };
    };

    return (
      <>
        <div style={{ marginBottom: 24 }}>
          <h1 style={{ fontSize: 36, fontWeight: 900, marginBottom: 8, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>üìã <EditableText k="sheet.title" fallback="Planilha de Dados" /></h1>
          <p style={{ fontSize: 16, color: 'rgba(255,255,255,0.6)' }}><EditableText k="sheet.subtitle" fallback="Edite os dados como no Excel ‚Äî todas as altera√ß√µes refletem automaticamente no dashboard" /></p>
          <div style={{ display: 'flex', gap: 8, marginTop: 12, flexWrap: 'wrap' }}>
            <span style={{ fontSize: 11, padding: '4px 10px', borderRadius: 6, background: 'rgba(252,211,77,0.1)', color: colors.yellow, fontWeight: 600 }}>üí° <EditableText k="sheet.hint1" fallback="Clique em qualquer c√©lula para editar" /></span>
            <span style={{ fontSize: 11, padding: '4px 10px', borderRadius: 6, background: 'rgba(252,211,77,0.1)', color: colors.yellow, fontWeight: 600 }}>‚èé <EditableText k="sheet.hint2" fallback="Enter salva ‚Ä¢ Esc cancela ‚Ä¢ Tab pr√≥xima" /></span>
          </div>
        </div>

        {/* Toolbar */}
        <div style={{ display: 'flex', gap: 10, marginBottom: 16, flexWrap: 'wrap' }}>
          <button onClick={addVendor} style={{ padding: '8px 18px', border: 'none', borderRadius: 10, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, color: colors.darker, fontWeight: 700, cursor: 'pointer', fontSize: 13, display: 'flex', alignItems: 'center', gap: 6 }}>
            ‚ûï <EditableText k="sheet.btn.novo" fallback="Novo Vendedor" />
          </button>
          <button onClick={addMonth} style={{ padding: '8px 18px', border: 'none', borderRadius: 10, background: 'rgba(252,211,77,0.15)', color: colors.yellow, fontWeight: 700, cursor: 'pointer', fontSize: 13, border: `1px solid rgba(252,211,77,0.3)`, display: 'flex', alignItems: 'center', gap: 6 }}>
            üìÖ <EditableText k="sheet.btn.mes" fallback="Adicionar M√™s" />
          </button>
          <div style={{ flex: 1 }} />
          <span style={{ fontSize: 12, color: 'rgba(255,255,255,0.4)', alignSelf: 'center' }}>{rows.length} vendedores ‚Ä¢ {allCols.length} colunas</span>
        </div>

        {/* Table */}
        <div style={{
          ...cardStyle, borderRadius: 16, padding: 0, overflow: 'hidden', border: `1px solid rgba(252,211,77,0.15)`
        }}>
          <div style={{ overflow: 'auto', maxHeight: '70vh' }}>
            <table style={{ width: '100%', borderCollapse: 'collapse', minWidth: allCols.length * 120 }}>
              <thead>
                <tr>
                  <th style={{ ...thStyle, width: 50, textAlign: 'center', position: 'sticky', left: 0, zIndex: 3 }}>#</th>
                  {allCols.map((col, ci) => (
                    <th key={col.key} style={{
                      ...thStyle,
                      ...(ci === 0 ? { position: 'sticky', left: 50, zIndex: 3 } : {}),
                      textAlign: col.type === 'number' || col.type === 'monthKPI' ? 'right' : 'left'
                    }}>{col.label}</th>
                  ))}
                  <th style={{ ...thStyle, width: 70, textAlign: 'center' }}>A√ß√µes</th>
                </tr>
              </thead>
              <tbody>
                {rows.map((vendor, ri) => {
                  const thermal = getVendorThermal((state.vendorStatus || {})[ri]);
                  const rowBorder = thermal === 'fire' ? 'rgba(255,100,0,0.2)' : thermal === 'freezing' ? 'rgba(0,191,255,0.15)' : 'transparent';
                  return (
                    <tr key={ri} style={{ background: rowBorder }}>
                      {/* Row number */}
                      <td style={{
                        padding: '8px 10px', fontSize: 13, fontWeight: 800, color: 'rgba(255,255,255,0.4)',
                        textAlign: 'center', borderBottom: '1px solid rgba(255,255,255,0.06)',
                        borderRight: '1px solid rgba(255,255,255,0.08)',
                        background: ri % 2 === 0 ? 'rgba(31,41,55,0.9)' : 'rgba(17,24,39,0.9)',
                        position: 'sticky', left: 0, zIndex: 1
                      }}>{ri + 1}</td>

                      {allCols.map((col, ci) => {
                        const isEditing = editCell?.row === ri && editCell?.col === ci;
                        const val = getCellValue(ri, col);

                        // Status column with mini buttons
                        if (col.key === '_status') {
                          const st = statusBg(val);
                          return (
                            <td key={col.key} style={{ ...tdStyle(ri, ci), padding: '4px 8px' }}>
                              <div style={{ display: 'flex', gap: 4 }}>
                                <button onClick={() => registerSale(ri)} style={{ padding: '2px 6px', border: val === 'fire' ? '2px solid #ff6600' : '1px solid rgba(255,100,0,0.3)', borderRadius: 6, fontSize: 13, cursor: 'pointer', background: val === 'fire' ? 'rgba(255,100,0,0.3)' : 'rgba(255,100,0,0.08)', color: '#ff8800', lineHeight: 1 }} title="Pegando Fogo">üî•</button>
                                <button onClick={() => setNormal(ri)} style={{ padding: '2px 6px', border: val === 'normal' ? '2px solid #10B981' : '1px solid rgba(16,185,129,0.3)', borderRadius: 6, fontSize: 13, cursor: 'pointer', background: val === 'normal' ? 'rgba(16,185,129,0.3)' : 'rgba(16,185,129,0.08)', color: '#10B981', lineHeight: 1 }} title="Normal">‚úÖ</button>
                                <button onClick={() => setFreezing(ri)} style={{ padding: '2px 6px', border: val === 'freezing' ? '2px solid #00bfff' : '1px solid rgba(0,191,255,0.3)', borderRadius: 6, fontSize: 13, cursor: 'pointer', background: val === 'freezing' ? 'rgba(0,191,255,0.3)' : 'rgba(0,191,255,0.08)', color: '#00bfff', lineHeight: 1 }} title="Congelando">ü•∂</button>
                              </div>
                            </td>
                          );
                        }

                        // Nivel column with colored badge
                        if (col.key === '_nivel') {
                          const lc = getLevelClass(val);
                          const lColor = levelColors[lc] || '#CD7F32';
                          return (
                            <td key={col.key} style={tdStyle(ri, ci)}>
                              <span style={{ padding: '3px 10px', borderRadius: 12, fontSize: 11, fontWeight: 700, background: `${lColor}33`, color: lColor, border: `1px solid ${lColor}` }}>{val}</span>
                            </td>
                          );
                        }

                        return (
                          <td key={col.key} style={{
                            ...tdStyle(ri, ci),
                            ...(ci === 0 ? { position: 'sticky', left: 50, zIndex: 1, background: ri % 2 === 0 ? 'rgba(31,41,55,0.95)' : 'rgba(17,24,39,0.95)' } : {})
                          }} onDoubleClick={() => startEdit(ri, ci)} onClick={() => { if (col.type !== 'computed') startEdit(ri, ci); }}>
                            {isEditing ? (
                              <input ref={cellRef} value={cellValue} onChange={e => setCellValue(e.target.value)}
                                onBlur={saveCell} onKeyDown={handleKey}
                                type={col.type === 'number' || col.type === 'monthKPI' ? 'number' : 'text'}
                                style={{ ...inputStyle, textAlign: col.type === 'number' || col.type === 'monthKPI' ? 'right' : 'left' }} />
                            ) : (
                              formatDisplay(val, col)
                            )}
                          </td>
                        );
                      })}

                      {/* Delete button */}
                      <td style={{ padding: '8px', borderBottom: '1px solid rgba(255,255,255,0.06)', textAlign: 'center', background: ri % 2 === 0 ? 'rgba(31,41,55,0.8)' : 'rgba(17,24,39,0.8)' }}>
                        <button onClick={() => deleteVendor(ri)} style={{ padding: '4px 8px', border: '1px solid rgba(239,68,68,0.3)', borderRadius: 6, fontSize: 13, cursor: 'pointer', background: 'rgba(239,68,68,0.1)', color: '#ef4444', lineHeight: 1 }} title="Excluir vendedor">üóëÔ∏è</button>
                      </td>
                    </tr>
                  );
                })}

                {/* Totals row */}
                <tr style={{ background: 'rgba(252,211,77,0.08)' }}>
                  <td style={{ padding: '10px', fontSize: 12, fontWeight: 900, textAlign: 'center', borderTop: `2px solid ${colors.yellow}`, color: colors.yellow }}>Œ£</td>
                  {allCols.map((col) => {
                    let total = '';
                    if (col.key === 'Nome') total = `${rows.length} vendedores`;
                    else if (col.key === 'Contratos') total = formatNumber(totals.contracts);
                    else if (col.key === 'Faturamento') total = formatCurrency(totals.revenue);
                    else if (col.key === 'Cartoes') total = formatNumber(totals.cards);
                    else if (col.key === 'Badges') total = formatNumber(rows.reduce((a, r) => a + (r.Badges || 0), 0));
                    else if (col.key === '_ticketMedio') total = totals.contracts ? formatCurrency(totals.revenue / totals.contracts) : 'R$ 0';
                    else if (col.type === 'monthKPI') {
                      let sum = 0;
                      rows.forEach((_, ri) => {
                        const vkpi = (state.vendorMonthlyKPIs || {})[ri];
                        sum += parseFloat(vkpi?.[col.month]?.[col.field]) || 0;
                      });
                      total = col.field === 'revenue' ? formatCurrency(sum) : formatNumber(sum);
                    }
                    return (
                      <td key={col.key} style={{
                        padding: '10px 14px', fontSize: 13, fontWeight: 900, color: colors.yellow,
                        borderTop: `2px solid ${colors.yellow}`,
                        textAlign: col.type === 'number' || col.type === 'monthKPI' || col.key === '_ticketMedio' ? 'right' : 'left',
                        whiteSpace: 'nowrap'
                      }}>{total}</td>
                    );
                  })}
                  <td style={{ borderTop: `2px solid ${colors.yellow}` }} />
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        {/* Legend */}
        <div style={{ marginTop: 16, display: 'flex', gap: 20, flexWrap: 'wrap', fontSize: 12, color: 'rgba(255,255,255,0.4)' }}>
          <span>üü° <EditableText k="sheet.leg1" fallback="C√©lulas edit√°veis ‚Äî clique para editar" /></span>
          <span>‚¨ú <EditableText k="sheet.leg2" fallback="C√©lulas calculadas ‚Äî atualizam automaticamente" /></span>
          <span>üîÑ <EditableText k="sheet.leg3" fallback="Sincroniza em tempo real via Firebase" /></span>
        </div>
      </>
    );
  };

  // ==================== SETTINGS MODAL ====================
  const SettingsModal = () => {
    if (!settingsOpen) return null;
    return (
      <div onClick={() => setSettingsOpen(false)} style={{ position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', background: 'rgba(0,0,0,0.8)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10000 }}>
        <div onClick={e => e.stopPropagation()} style={{ background: `linear-gradient(135deg, ${colors.dark}, ${colors.darker})`, border: '1px solid rgba(252,211,77,0.2)', borderRadius: 24, padding: 40, maxWidth: 500, width: '90%' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 32, paddingBottom: 20, borderBottom: '2px solid rgba(252,211,77,0.2)' }}>
            <h2 style={{ fontSize: 28, fontWeight: 900, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>‚öôÔ∏è <EditableText k="settings.title" fallback="Configura√ß√µes" /></h2>
            <button onClick={() => setSettingsOpen(false)} style={{ width: 40, height: 40, border: 'none', background: colors.error, color: 'white', borderRadius: '50%', cursor: 'pointer', fontSize: 24 }}>√ó</button>
          </div>
          <p style={{ color: 'rgba(255,255,255,0.7)', marginBottom: 24 }}><EditableText k="settings.desc" fallback="Configure as cores e par√¢metros do dashboard." /></p>
          <div style={{ marginBottom: 16 }}>
            <label style={{ display: 'block', color: 'white', marginBottom: 8 }}><EditableText k="settings.corPrim" fallback="Cor Prim√°ria" /></label>
            <input type="color" id="colorPrimary" defaultValue={colors.yellow} style={{ width: 60, height: 40 }} />
          </div>
          <div style={{ marginBottom: 24 }}>
            <label style={{ display: 'block', color: 'white', marginBottom: 8 }}><EditableText k="settings.corSec" fallback="Cor Secund√°ria" /></label>
            <input type="color" id="colorSecondary" defaultValue={colors.gold} style={{ width: 60, height: 40 }} />
          </div>
          <button onClick={() => {
            const p = document.getElementById('colorPrimary')?.value;
            const s = document.getElementById('colorSecondary')?.value;
            updateState(st => {
              if (!st.customizations) st.customizations = { texts: {}, colors: {}, logo: '' };
              if (!st.customizations.colors) st.customizations.colors = {};
              if (p) st.customizations.colors['lecard-yellow'] = p;
              if (s) st.customizations.colors['lecard-gold'] = s;
            });
            setSettingsOpen(false);
            showToast('Configura√ß√µes salvas!');
          }} style={{ padding: '12px 24px', borderRadius: 12, border: 'none', fontWeight: 700, cursor: 'pointer', background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, color: colors.darker, fontSize: 14 }}>üíæ <EditableText k="settings.btnSalvar" fallback="Salvar" /></button>
        </div>
      </div>
    );
  };

  // ==================== MAIN LAYOUT ====================
  const navItems = [
    { id: 'dashboard', icon: 'üìä', label: t('nav.dashboard','Dashboard') },
    { id: 'spreadsheet', icon: 'üìã', label: t('nav.planilha','Planilha') },
    { id: 'projections', icon: 'üìà', label: t('nav.projecoes','Proje√ß√µes 2026') },
    { id: 'arena', icon: 'üèÜ', label: t('nav.arena','Arena') },
    { id: 'monthlyKPIs', icon: 'üìÖ', label: t('nav.kpis','KPIs Mensais') }
  ];

  const syncColors = { connected: '#10B981', connecting: '#F59E0B', reconnecting: '#F59E0B', offline: '#EF4444', syncing: '#3B82F6' };
  const syncLabels = { connected: 'Sincronizado ‚úì', connecting: 'Conectando...', reconnecting: 'Reconectando...', offline: 'Offline', syncing: 'Sincronizando...' };

  return (
    <div style={{ fontFamily: "'Inter', -apple-system, sans-serif", background: `linear-gradient(135deg, ${colors.darker} 0%, ${colors.dark} 100%)`, color: 'white', minHeight: '100vh' }}>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />

      {/* Toast */}
      {toast && (
        <div style={{ position: 'fixed', bottom: 32, right: 32, background: `linear-gradient(135deg, ${colors.dark}, ${colors.darker})`, padding: '20px 28px', borderRadius: 16, border: `1px solid ${toast.type === 'success' ? colors.success : toast.type === 'error' ? colors.error : colors.info}`, display: 'flex', alignItems: 'center', gap: 16, zIndex: 10001, animation: 'slideIn 0.3s ease-out', minWidth: 280 }}>
          <span style={{ fontSize: 24 }}>{toast.type === 'success' ? '‚úÖ' : toast.type === 'error' ? '‚ùå' : toast.type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</span>
          <span style={{ fontWeight: 600 }}>{toast.msg}</span>
        </div>
      )}

      <style>{`@keyframes slideIn { from { transform: translateX(200px); opacity:0; } to { transform: translateX(0); opacity:1; } }
        @keyframes fireGlow {
          0% { box-shadow: 0 0 8px #ff6600, 0 0 16px #ff4400, 0 0 24px rgba(255,68,0,0.4); border-color: #ff6600; }
          25% { box-shadow: 0 0 12px #ff8800, 0 0 24px #ff4400, 0 0 36px rgba(255,68,0,0.5); border-color: #ff8800; }
          50% { box-shadow: 0 0 16px #ffaa00, 0 0 32px #ff6600, 0 0 48px rgba(255,68,0,0.6); border-color: #ffaa00; }
          75% { box-shadow: 0 0 12px #ff8800, 0 0 24px #ff4400, 0 0 36px rgba(255,68,0,0.5); border-color: #ff8800; }
          100% { box-shadow: 0 0 8px #ff6600, 0 0 16px #ff4400, 0 0 24px rgba(255,68,0,0.4); border-color: #ff6600; }
        }
        @keyframes fireShake {
          0%, 100% { transform: translateX(0); }
          10% { transform: translateX(-1px) rotate(-0.5deg); }
          20% { transform: translateX(1px) rotate(0.5deg); }
          30% { transform: translateX(-1px); }
          40% { transform: translateX(1px); }
          50% { transform: translateX(0); }
        }
        @keyframes fireEmoji {
          0%, 100% { transform: scale(1) rotate(0deg); }
          25% { transform: scale(1.2) rotate(-5deg); }
          50% { transform: scale(1.3) rotate(5deg); }
          75% { transform: scale(1.1) rotate(-3deg); }
        }
        @keyframes freezeGlow {
          0% { box-shadow: 0 0 8px #00bfff, 0 0 16px #0080ff, 0 0 24px rgba(0,128,255,0.3); border-color: #00bfff; }
          50% { box-shadow: 0 0 16px #80dfff, 0 0 32px #00bfff, 0 0 48px rgba(0,191,255,0.4); border-color: #80dfff; }
          100% { box-shadow: 0 0 8px #00bfff, 0 0 16px #0080ff, 0 0 24px rgba(0,128,255,0.3); border-color: #00bfff; }
        }
        @keyframes freezePulse {
          0%, 100% { opacity: 1; filter: brightness(1); }
          50% { opacity: 0.85; filter: brightness(1.1) saturate(0.7); }
        }
        @keyframes freezeEmoji {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.15) rotate(3deg); }
        }
        @keyframes floatUp {
          0% { opacity: 1; transform: translateY(0) scale(1); }
          100% { opacity: 0; transform: translateY(-40px) scale(0.5); }
        }
        .fire-item { animation: fireGlow 1.5s ease-in-out infinite, fireShake 3s ease-in-out infinite; }
        .fire-emoji { animation: fireEmoji 0.8s ease-in-out infinite; display: inline-block; }
        .freeze-item { animation: freezeGlow 2s ease-in-out infinite, freezePulse 3s ease-in-out infinite; }
        .freeze-emoji { animation: freezeEmoji 2s ease-in-out infinite; display: inline-block; }
        .fire-badge { background: linear-gradient(135deg, #ff4400, #ff8800) !important; color: white !important; border: none !important; }
        .freeze-badge { background: linear-gradient(135deg, #0080ff, #00bfff) !important; color: white !important; border: none !important; }
      `}</style>

      {/* Sidebar Toggle */}
      <button onClick={() => setSidebarHidden(!sidebarHidden)} style={{ position: 'fixed', top: 12, left: 12, width: 40, height: 40, display: 'flex', alignItems: 'center', justifyContent: 'center', background: colors.yellow, color: colors.darker, border: 'none', borderRadius: '50%', fontSize: 20, cursor: 'pointer', zIndex: 1100, boxShadow: '0 4px 10px rgba(252,211,77,0.4)' }}>‚ò∞</button>

      {/* Sidebar */}
      {!sidebarHidden && (
        <aside style={{ width: 280, minHeight: '100vh', padding: 24, background: `linear-gradient(180deg, ${colors.dark} 0%, ${colors.darker} 100%)`, borderRight: '1px solid rgba(252,211,77,0.1)', position: 'fixed', left: 0, top: 0, overflowY: 'auto', zIndex: 1000 }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 40, paddingBottom: 24, borderBottom: '2px solid rgba(252,211,77,0.2)' }}>
            <div style={{ width: 50, height: 50, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, borderRadius: 12, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 28, fontWeight: 900, color: colors.darker, boxShadow: '0 4px 12px rgba(252,211,77,0.3)' }}><EditableText k="brand.logo" fallback="LC" /></div>
            <span style={{ fontSize: 24, fontWeight: 900, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}><EditableText k="brand.name" fallback="LeCard" /></span>
          </div>

          {/* Sync Status */}
          <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 8, padding: '8px 12px', borderRadius: 8, background: 'rgba(252,211,77,0.05)' }}>
            <div style={{ width: 8, height: 8, borderRadius: '50%', background: syncColors[syncStatus], boxShadow: `0 0 8px ${syncColors[syncStatus]}`, animation: syncStatus === 'syncing' ? 'pulse 0.5s ease-in-out infinite' : syncStatus === 'reconnecting' ? 'pulse 1s ease-in-out infinite' : 'none' }} />
            <span style={{ fontSize: 12, fontWeight: 600, color: syncColors[syncStatus] }}>{syncLabels[syncStatus]}</span>
          </div>
          {(syncStatus === 'offline' || syncStatus === 'reconnecting') && (
            <div style={{ padding: '8px 12px', borderRadius: 8, background: 'rgba(239,68,68,0.1)', border: '1px solid rgba(239,68,68,0.3)', marginBottom: 16, fontSize: 11, color: '#EF4444', lineHeight: 1.5 }}>
              ‚ö†Ô∏è Sem conex√£o com Firebase.<br/>
              Verifique as regras do banco:<br/>
              <strong>Firebase Console ‚Üí Realtime Database ‚Üí Rules</strong><br/>
              <code style={{ background: 'rgba(0,0,0,0.3)', padding: '2px 4px', borderRadius: 3 }}>
                {`{".read": true, ".write": true}`}
              </code>
              <br/><br/>
              <button onClick={async () => {
                setSyncStatus('connecting');
                try {
                  const test = await fbGet('state');
                  if (test !== null) {
                    setSyncStatus('connected');
                    showToast('Conex√£o OK!');
                    if (test.data?.rows) {
                      const { _meta, ...clean } = test;
                      setState(clean);
                    }
                  } else {
                    setSyncStatus('offline');
                    showToast('Firebase acess√≠vel mas sem dados. Salvando...', 'info');
                    await fbSet('state', { ...state, _meta: { deviceId: deviceId.current, version: Date.now() } });
                    setSyncStatus('connected');
                  }
                } catch(err) {
                  setSyncStatus('offline');
                  showToast('Falha: ' + err.message, 'error');
                }
              }} style={{ marginTop: 4, padding: '4px 12px', border: 'none', borderRadius: 6, background: '#EF4444', color: 'white', fontSize: 11, fontWeight: 700, cursor: 'pointer' }}>
                üîÑ Testar Conex√£o
              </button>
            </div>
          )}
          <style>{`@keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.3); } }`}</style>

          <div style={{ marginBottom: 32 }}>
            <div style={{ fontSize: 11, fontWeight: 700, textTransform: 'uppercase', letterSpacing: 1, color: 'rgba(255,255,255,0.5)', marginBottom: 12, paddingLeft: 12 }}><EditableText k="nav.section.main" fallback="Menu Principal" /></div>
            {navItems.map(n => (
              <div key={n.id} onClick={() => setPage(n.id)} style={{
                padding: '14px 16px', borderRadius: 12, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 12, marginBottom: 4, transition: 'all 0.3s',
                ...(page === n.id
                  ? { background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, color: colors.darker, fontWeight: 700, boxShadow: '0 4px 12px rgba(252,211,77,0.4)' }
                  : { color: 'rgba(255,255,255,0.7)' })
              }}>
                <span style={{ fontSize: 20 }}>{n.icon}</span><span><EditableText k={`nav.${n.id}`} fallback={n.label} /></span>
              </div>
            ))}
          </div>

          <div>
            <div style={{ fontSize: 11, fontWeight: 700, textTransform: 'uppercase', letterSpacing: 1, color: 'rgba(255,255,255,0.5)', marginBottom: 12, paddingLeft: 12 }}><EditableText k="nav.section.tools" fallback="Ferramentas" /></div>
            <div onClick={() => { if (!editMode) { setEditMode(true); showToast('Modo edi√ß√£o ativado. Clique nos valores para editar.', 'info'); } else { showToast('Voc√™ j√° est√° em modo edi√ß√£o.', 'info'); } }} style={{ padding: '14px 16px', borderRadius: 12, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 12, marginBottom: 4, color: 'rgba(255,255,255,0.7)' }}>
              <span style={{ fontSize: 20 }}>üìù</span><span><EditableText k="nav.editDados" fallback="Editar Dados" /></span>
            </div>
            <div onClick={() => setSettingsOpen(true)} style={{ padding: '14px 16px', borderRadius: 12, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 12, marginBottom: 4, color: 'rgba(255,255,255,0.7)' }}>
              <span style={{ fontSize: 20 }}>‚öôÔ∏è</span><span><EditableText k="nav.config" fallback="Configura√ß√µes" /></span>
            </div>
            <div onClick={addVendor} style={{ padding: '14px 16px', borderRadius: 12, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 12, marginBottom: 4, color: 'rgba(255,255,255,0.7)' }}>
              <span style={{ fontSize: 20 }}>‚ûï</span><span><EditableText k="nav.addVendor" fallback="Adicionar Vendedor" /></span>
            </div>
            <div onClick={() => { setEditMode(!editMode); showToast(editMode ? 'Modo visualiza√ß√£o' : 'Modo edi√ß√£o ativado', editMode ? 'success' : 'info'); }} style={{
              padding: '14px 16px', borderRadius: 12, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 12, marginBottom: 4,
              ...(editMode ? { background: `rgba(252,211,77,0.15)`, color: colors.yellow, fontWeight: 700 } : { color: 'rgba(255,255,255,0.7)' })
            }}>
              <span style={{ fontSize: 20 }}>‚úèÔ∏è</span><span>{editMode ? <EditableText k="nav.modoVis" fallback="Modo Visualiza√ß√£o" /> : <EditableText k="nav.editPainel" fallback="Editar Painel" />}</span>
            </div>
          </div>
        </aside>
      )}

      {/* Main Content */}
      <main style={{ marginLeft: sidebarHidden ? 0 : 280, padding: 40, minHeight: '100vh', transition: 'margin-left 0.3s', overflowX: 'hidden' }}>
        {page === 'dashboard' && <DashboardPage />}
        {page === 'spreadsheet' && <SpreadsheetPage />}
        {page === 'projections' && <ProjectionsPage />}
        {page === 'arena' && <ArenaPage />}
        {page === 'monthlyKPIs' && <MonthlyKPIsPage />}
      </main>

      {/* Floating Action */}
      <div onClick={() => showToast('Use o modo edi√ß√£o para alterar KPIs, metas e dados.', 'info')} style={{ position: 'fixed', bottom: 32, right: 32, width: 60, height: 60, background: `linear-gradient(135deg, ${colors.yellow}, ${colors.gold})`, borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 24, cursor: 'pointer', boxShadow: '0 8px 24px rgba(252,211,77,0.4)', zIndex: 999, transition: 'all 0.3s' }}>‚ö°</div>

      <SettingsModal />
    </div>
  );
}

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(LeCardDashboard));
  </script>
</body>
</html>
